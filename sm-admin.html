<html><head><meta charset="UTF-8"><link rel="import" href="../simpla-block/simpla-block.html"><link rel="import" href="../sm-ui-toolbar/sm-ui-toolbar.html"><link rel="import" href="../sm-utility-share/sm-utility-share.html"><link rel="import" href="../sm-utility-auth/sm-utility-auth.html"><link rel="import" href="../sm-module-notify/sm-module-notify.html"><link rel="import" href="../sm-module-save/sm-module-save.html"><link rel="import" href="../sm-module-login/sm-module-login.html"><link rel="import" href="../simpla-core/simpla-core.html"><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="sm-admin">
  <template>
    <style include="sm-css"></style>
    <style>
:host * {
  z-index: var(--on-top);
}

.save {
  position: fixed;
  top: 12px;
  right: 12px;
}

</style>

    <template is="dom-if" if="{{_edit}}" restamp="">
      <template is="dom-if" if="{{_notAuthenticated}}" restamp="">
        <sm-module-login id="login" class="login"></sm-module-login>
      </template>

      <template is="dom-if" if="{{_authenticated}}" restamp="">
        <sm-module-save id="save" class="save"></sm-module-save>
      </template>
    </template>

    <sm-ui-toolbar id="toolbar" hidden="{{!_edit}}"></sm-ui-toolbar>

    <sm-module-notify id="notify" class="notify"></sm-module-notify>
    <sm-utility-auth id="auth" token="{{_token}}" authenticated="{{_authenticated}}"></sm-utility-auth>
    <sm-utility-share type="state" key="editable" value="{{_editable}}"></sm-utility-share>
    <sm-utility-share type="singletons" key="toolbar" value="{{_toolbar}}"></sm-utility-share>
  </template>
  <script>/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	module.exports = __webpack_require__(2);


/***/ },
/* 1 */
/***/ function(module, exports) {

	'use strict';

	Object.defineProperty(exports, '__esModule', {
	  value: true
	});
	var EVENTS = ['tap', 'mouseup', 'mousedown', 'click', 'touchup', 'touchdown'],
	    SIMPLA_SELECTOR = 'simpla-img, simpla-text',
	    SM_SELECTOR = 'simpla-img, simpla-text, sm-admin';

	function stopEvent(event) {
	  event.stopPropagation();
	}

	function stopAllEvents(element) {
	  EVENTS.forEach(function (ev) {
	    return element.addEventListener(ev, stopEvent);
	  });
	  element._restoreEvents = function () {
	    EVENTS.forEach(function (ev) {
	      return element.removeEventListener(ev, stopEvent);
	    });
	  };
	}

	function runOnNonSimpla(root, callback) {
	  var hasSimpla = function hasSimpla(tree) {
	    return tree.querySelectorAll(SM_SELECTOR).length !== 0;
	  },
	      isSimpla = function isSimpla(element) {
	    return !!element.localName.match(/simpla-*|sm-/);
	  },
	      walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, function (element) {
	    if (isSimpla(element)) {
	      return NodeFilter.FILTER_REJECT;
	    }

	    if (hasSimpla(element)) {
	      return NodeFilter.FILTER_SKIP;
	    }

	    return NodeFilter.FILTER_ACCEPT;
	  }),
	      element = undefined;

	  while (element = walker.nextNode()) {
	    callback(element);
	  }
	}

	function disablePointerEvents(element) {
	  element.style.pointerEvents = 'none';
	};

	function enablePointerEvents(element) {
	  element.style.pointerEvents = '';
	};

	function getSimplaElements(root) {
	  return [].slice.call(root.querySelectorAll(SIMPLA_SELECTOR));
	};

	exports['default'] = {
	  properties: {
	    _clicksDisabled: {
	      type: Boolean,
	      value: false
	    }
	  },

	  observers: ['_shouldDisableClicks(_edit, _clicksDisabled)'],

	  _disableClickEvents: function _disableClickEvents(root) {
	    var elements = getSimplaElements(root);
	    elements.forEach(stopAllEvents);
	    runOnNonSimpla(root, disablePointerEvents);

	    this._clicksDisabled = true;
	  },

	  _enableClickEvents: function _enableClickEvents(root) {
	    var elements = getSimplaElements(root);
	    elements.forEach(function (el) {
	      return el._restoreEvents();
	    });

	    runOnNonSimpla(root, enablePointerEvents);

	    this._clicksDisabled = false;
	  },

	  _shouldDisableClicks: function _shouldDisableClicks(edit, disabled) {
	    var root = document.body;

	    if (edit && !disabled) {
	      this._disableClickEvents(root);
	    } else if (!edit && disabled) {
	      this._enableClickEvents(root);
	    }
	  }
	};
	module.exports = exports['default'];

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

	var _behaviorsClickEvents = __webpack_require__(1);

	var _behaviorsClickEvents2 = _interopRequireDefault(_behaviorsClickEvents);

	var EDIT = 'edit';

	var SmAdmin = (function () {
	  function SmAdmin() {
	    _classCallCheck(this, SmAdmin);
	  }

	  /**
	   * When DOM is ready, inject admin and namespace body
	   */

	  _createClass(SmAdmin, [{
	    key: 'beforeRegister',
	    value: function beforeRegister() {
	      this.is = 'sm-admin';

	      this.properties = {
	        _authenticated: {
	          type: Boolean,
	          observer: '_authenticatedChanged'
	        },
	        _notAuthenticated: {
	          type: Boolean,
	          computed: '_computeNotAuthenticated(_authenticated)',
	          value: true
	        },
	        _edit: {
	          type: Boolean,
	          value: false
	        },
	        _editable: Boolean,
	        _token: String
	      };

	      this.observers = ['_updateEditable(_authenticated, _edit)'];
	    }
	  }, {
	    key: 'ready',
	    value: function ready() {
	      var _this = this;

	      var updateEditFromHash = function updateEditFromHash() {
	        _this._edit = window.location.hash.split('#').pop() === EDIT;
	      };

	      var bodyMeta = undefined;

	      window.simpla = window.simpla || {};
	      window.simpla.notifications = this.$.notify;
	      window.addEventListener('hashchange', updateEditFromHash);

	      // Setup singleton instance
	      this._toolbar = this.$.toolbar;

	      // Setup state
	      updateEditFromHash();
	      this._token = window.localStorage.getItem('sm-token');

	      // Setup body to take metadata
	      bodyMeta = document.createElement('sm-meta-data');
	      bodyMeta.block = document.body;
	      bodyMeta.uid = encodeURIComponent(simpla.config.baseurl + window.location.pathname);
	    }
	  }, {
	    key: '_computeNotAuthenticated',
	    value: function _computeNotAuthenticated(_authenticated) {
	      return !_authenticated;
	    }
	  }, {
	    key: '_updateEditable',
	    value: function _updateEditable(_authenticated, _edit) {
	      this._editable = _authenticated && _edit;
	    }
	  }, {
	    key: '_authenticatedChanged',
	    value: function _authenticatedChanged(_authenticated, was) {
	      if (was && !_authenticated) {
	        window.location.hash = '';
	      }
	      if (_authenticated) {
	        this.fire('logged-in');
	      }
	    }
	  }]);

	  return SmAdmin;
	})();

	function inject() {
	  var body = undefined,
	      admin = undefined,
	      namespace = undefined;

	  body = document.body;

	  // Namespace
	  namespace = document.createElement('sm-block-namespace');
	  namespace.uid = simpla.config.baseurl.replace('.', '\\.');
	  namespace.block = body;

	  // Append admin
	  admin = document.createElement('sm-admin');
	  body.appendChild(admin);
	}

	if (document.readyState === 'complete') {
	  inject();
	} else {
	  document.addEventListener('DOMContentLoaded', inject);
	}

	Polymer(SmAdmin);

/***/ }
/******/ ]);</script>
</dom-module>
</body></html>